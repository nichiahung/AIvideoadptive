# AdaptVideo éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®éŒ„

1. [éƒ¨ç½²å‰æº–å‚™](#éƒ¨ç½²å‰æº–å‚™)
2. [æœ¬åœ°éƒ¨ç½²](#æœ¬åœ°éƒ¨ç½²)
3. [ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²](#ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²)
4. [é›²ç«¯éƒ¨ç½²](#é›²ç«¯éƒ¨ç½²)
5. [ç³»çµ±é…ç½®](#ç³»çµ±é…ç½®)
6. [æ•ˆèƒ½å„ªåŒ–](#æ•ˆèƒ½å„ªåŒ–)
7. [å®‰å…¨æ€§è¨­å®š](#å®‰å…¨æ€§è¨­å®š)
8. [ç›£æ§èˆ‡ç¶­è­·](#ç›£æ§èˆ‡ç¶­è­·)
9. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ”§ éƒ¨ç½²å‰æº–å‚™

### ç³»çµ±éœ€æ±‚æª¢æŸ¥

#### æœ€ä½é…ç½®
- **CPU**: é›™æ ¸å¿ƒ 2.0GHz ä»¥ä¸Š
- **è¨˜æ†¶é«”**: 8GB RAM
- **å„²å­˜ç©ºé–“**: 10GB å¯ç”¨ç©ºé–“
- **ä½œæ¥­ç³»çµ±**: 
  - Windows 10/11 (64-bit)
  - macOS 10.15+
  - Ubuntu 18.04+ / CentOS 7+
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬

#### å»ºè­°é…ç½®
- **CPU**: å››æ ¸å¿ƒ 3.0GHz ä»¥ä¸Š
- **è¨˜æ†¶é«”**: 16GB RAM
- **å„²å­˜ç©ºé–“**: SSD 50GB ä»¥ä¸Š
- **GPU**: NVIDIA GPU (å¯é¸ï¼ŒåŠ é€Ÿå½±ç‰‡è™•ç†)

### å¿…è¦è»Ÿé«”å®‰è£

#### Python ç’°å¢ƒ
```bash
# æª¢æŸ¥ Python ç‰ˆæœ¬
python --version  # Windows
python3 --version # macOS/Linux

# å®‰è£ pip (å¦‚æœªå®‰è£)
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python get-pip.py
```

#### ç³»çµ±ä¾è³´
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y ffmpeg python3-pip python3-venv

# CentOS/RHEL
sudo yum install -y ffmpeg python3-pip python3-venv

# macOS (ä½¿ç”¨ Homebrew)
brew install ffmpeg python@3.9
```

### API é‡‘é‘°è¨­å®š

1. å–å¾— OpenAI API é‡‘é‘°ï¼š
   - å‰å¾€ https://platform.openai.com/api-keys
   - å»ºç«‹æ–°çš„ API é‡‘é‘°
   - è¤‡è£½é‡‘é‘°å‚™ç”¨

2. è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š
   ```bash
   # è¤‡è£½ç¯„ä¾‹æª”æ¡ˆ
   cp .env.example .env
   
   # ç·¨è¼¯ .env æª”æ¡ˆ
   # åŠ å…¥ OPENAI_API_KEY=your_api_key_here
   ```

---

## ğŸ  æœ¬åœ°éƒ¨ç½²

### å¿«é€Ÿéƒ¨ç½² (æ¨è–¦)

#### Windows
1. é›™æ“ŠåŸ·è¡Œ `start_windows.bat`
2. ç­‰å¾…è‡ªå‹•å®‰è£å®Œæˆ
3. ç€è¦½å™¨è‡ªå‹•é–‹å•Ÿ http://localhost:5001

#### macOS/Linux
```bash
# çµ¦äºˆåŸ·è¡Œæ¬Šé™
chmod +x start_unix.sh

# åŸ·è¡Œå®‰è£è…³æœ¬
./start_unix.sh
```

### æ‰‹å‹•éƒ¨ç½²

1. **å»ºç«‹è™›æ“¬ç’°å¢ƒ**
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate
   
   # macOS/Linux
   python3 -m venv venv
   source venv/bin/activate
   ```

2. **å®‰è£ä¾è³´å¥—ä»¶**
   ```bash
   pip install -r requirements.txt
   ```

3. **åˆå§‹åŒ–ç›®éŒ„**
   ```bash
   mkdir -p uploads outputs
   ```

4. **å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼**
   ```bash
   python app.py
   ```

### é©—è­‰éƒ¨ç½²

1. æª¢æŸ¥æœå‹™ç‹€æ…‹ï¼š
   - çµ‚ç«¯æ©Ÿé¡¯ç¤º "Running on http://127.0.0.1:5001"
   - ç€è¦½å™¨å¯æ­£å¸¸è¨ªå•

2. åŠŸèƒ½æ¸¬è©¦ï¼š
   - ä¸Šå‚³æ¸¬è©¦å½±ç‰‡
   - åŸ·è¡Œ AI åˆ†æ
   - è½‰æ›ä¸¦ä¸‹è¼‰çµæœ

---

## ğŸš€ ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

### ä½¿ç”¨ Gunicorn (Linux/macOS)

1. **å®‰è£ Gunicorn**
   ```bash
   pip install gunicorn
   ```

2. **é…ç½® Gunicorn**
   ```bash
   # gunicorn_config.py
   bind = "0.0.0.0:5001"
   workers = 4
   worker_class = "sync"
   worker_connections = 1000
   timeout = 300
   keepalive = 2
   threads = 4
   ```

3. **å•Ÿå‹•æœå‹™**
   ```bash
   gunicorn -c gunicorn_config.py app:app
   ```

### ä½¿ç”¨ Waitress (Windows)

1. **å®‰è£ Waitress**
   ```bash
   pip install waitress
   ```

2. **å•Ÿå‹•æœå‹™**
   ```python
   # run_waitress.py
   from waitress import serve
   from app import app
   
   serve(app, host='0.0.0.0', port=5001, threads=4)
   ```

### ä½¿ç”¨ Systemd (Linux)

1. **å»ºç«‹æœå‹™æª”æ¡ˆ**
   ```bash
   sudo nano /etc/systemd/system/adaptvideo.service
   ```

2. **æœå‹™é…ç½®**
   ```ini
   [Unit]
   Description=AdaptVideo Service
   After=network.target
   
   [Service]
   Type=simple
   User=www-data
   WorkingDirectory=/opt/adaptvideo
   Environment="PATH=/opt/adaptvideo/venv/bin"
   ExecStart=/opt/adaptvideo/venv/bin/gunicorn -c gunicorn_config.py app:app
   Restart=always
   
   [Install]
   WantedBy=multi-user.target
   ```

3. **å•Ÿç”¨æœå‹™**
   ```bash
   sudo systemctl enable adaptvideo
   sudo systemctl start adaptvideo
   sudo systemctl status adaptvideo
   ```

### åå‘ä»£ç†è¨­å®š

#### Nginx é…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    client_max_body_size 500M;
    
    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å½±ç‰‡ä¸Šå‚³è¶…æ™‚è¨­å®š
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;
    }
    
    location /static {
        alias /opt/adaptvideo/static;
        expires 30d;
    }
}
```

#### Apache é…ç½®
```apache
<VirtualHost *:80>
    ServerName your-domain.com
    
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:5001/
    ProxyPassReverse / http://127.0.0.1:5001/
    
    <Directory /opt/adaptvideo/static>
        Require all granted
    </Directory>
    
    Alias /static /opt/adaptvideo/static
</VirtualHost>
```

---

## â˜ï¸ é›²ç«¯éƒ¨ç½²

### Heroku éƒ¨ç½²

1. **æº–å‚™æª”æ¡ˆ**
   - ç¢ºèª `Procfile` å­˜åœ¨
   - ç¢ºèª `requirements.txt` å®Œæ•´

2. **éƒ¨ç½²æ­¥é©Ÿ**
   ```bash
   # å®‰è£ Heroku CLI
   # ç™»å…¥ Heroku
   heroku login
   
   # å»ºç«‹æ‡‰ç”¨
   heroku create your-app-name
   
   # è¨­å®šç’°å¢ƒè®Šæ•¸
   heroku config:set OPENAI_API_KEY=your_key_here
   
   # éƒ¨ç½²
   git push heroku main
   
   # æ“´å±• dyno
   heroku ps:scale web=1
   ```

### AWS EC2 éƒ¨ç½²

1. **å»ºç«‹ EC2 å¯¦ä¾‹**
   - é¸æ“‡ Ubuntu 20.04 LTS
   - å¯¦ä¾‹é¡å‹ï¼št3.medium æˆ–æ›´é«˜
   - é–‹æ”¾ç«¯å£ï¼š22 (SSH), 80 (HTTP), 443 (HTTPS)

2. **å®‰è£ç’°å¢ƒ**
   ```bash
   # æ›´æ–°ç³»çµ±
   sudo apt update && sudo apt upgrade -y
   
   # å®‰è£å¿…è¦è»Ÿé«”
   sudo apt install -y python3-pip python3-venv nginx ffmpeg
   
   # å…‹éš†å°ˆæ¡ˆ
   git clone your-repo-url /opt/adaptvideo
   cd /opt/adaptvideo
   
   # è¨­å®šè™›æ“¬ç’°å¢ƒ
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

3. **è¨­å®š Nginx å’Œ Systemd**
   - åƒè€ƒç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ç« ç¯€

### Docker å®¹å™¨åŒ–éƒ¨ç½²

1. **Dockerfile**
   ```dockerfile
   FROM python:3.9-slim
   
   # å®‰è£ç³»çµ±ä¾è³´
   RUN apt-get update && apt-get install -y \
       ffmpeg \
       && rm -rf /var/lib/apt/lists/*
   
   # è¨­å®šå·¥ä½œç›®éŒ„
   WORKDIR /app
   
   # è¤‡è£½éœ€æ±‚æª”æ¡ˆ
   COPY requirements.txt .
   RUN pip install --no-cache-dir -r requirements.txt
   
   # è¤‡è£½æ‡‰ç”¨ç¨‹å¼
   COPY . .
   
   # å»ºç«‹å¿…è¦ç›®éŒ„
   RUN mkdir -p uploads outputs
   
   # æš´éœ²ç«¯å£
   EXPOSE 5001
   
   # å•Ÿå‹•å‘½ä»¤
   CMD ["gunicorn", "-b", "0.0.0.0:5001", "-w", "4", "--timeout", "300", "app:app"]
   ```

2. **docker-compose.yml**
   ```yaml
   version: '3.8'
   
   services:
     web:
       build: .
       ports:
         - "5001:5001"
       environment:
         - OPENAI_API_KEY=${OPENAI_API_KEY}
       volumes:
         - ./uploads:/app/uploads
         - ./outputs:/app/outputs
       restart: unless-stopped
   ```

3. **éƒ¨ç½²å‘½ä»¤**
   ```bash
   # å»ºæ§‹æ˜ åƒ
   docker-compose build
   
   # å•Ÿå‹•æœå‹™
   docker-compose up -d
   
   # æŸ¥çœ‹æ—¥èªŒ
   docker-compose logs -f
   ```

---

## âš™ï¸ ç³»çµ±é…ç½®

### æ‡‰ç”¨ç¨‹å¼é…ç½®

ç·¨è¼¯ `config.py` èª¿æ•´è¨­å®šï¼š

```python
class Config:
    # æª”æ¡ˆå¤§å°é™åˆ¶
    MAX_FILE_SIZE = 500 * 1024 * 1024  # 500MB
    
    # æ”¯æ´çš„æª”æ¡ˆæ ¼å¼
    ALLOWED_EXTENSIONS = {'.mp4', '.avi', '.mov', '.mkv', '.webm'}
    
    # AI åˆ†æè¨­å®š
    MAX_FRAMES_FOR_ANALYSIS = 90
    
    # ä¼ºæœå™¨è¨­å®š
    DEBUG = False  # ç”Ÿç”¢ç’°å¢ƒè¨­ç‚º False
    HOST = '0.0.0.0'
    PORT = 5001
```

### ç’°å¢ƒè®Šæ•¸é…ç½®

å»ºç«‹ `.env` æª”æ¡ˆï¼š

```bash
# API é‡‘é‘°
OPENAI_API_KEY=your_key_here

# æ‡‰ç”¨è¨­å®š
FLASK_ENV=production
SECRET_KEY=your_secret_key_here

# è³‡æ–™åº«è¨­å®š (å¦‚ä½¿ç”¨)
DATABASE_URL=sqlite:///video_data.db

# æ—¥èªŒç´šåˆ¥
LOG_LEVEL=INFO
```

---

## ğŸ¯ æ•ˆèƒ½å„ªåŒ–

### å½±ç‰‡è™•ç†å„ªåŒ–

1. **ä½¿ç”¨ GPU åŠ é€Ÿ** (å¦‚å¯ç”¨)
   ```python
   # åœ¨ video_processing.py ä¸­å•Ÿç”¨ GPU
   import os
   os.environ['OPENCV_CUDA_DEVICE'] = '0'
   ```

2. **èª¿æ•´è™•ç†åƒæ•¸**
   - é™ä½é è¦½å“è³ªä»¥åŠ å¿«é€Ÿåº¦
   - é™åˆ¶åŒæ™‚è™•ç†çš„å½±ç‰‡æ•¸é‡
   - ä½¿ç”¨å½±ç‰‡ä¸²æµè€Œéå®Œæ•´è¼‰å…¥

### å¿«å–è¨­å®š

1. **éœæ…‹æª”æ¡ˆå¿«å–**
   ```nginx
   location /static {
       expires 30d;
       add_header Cache-Control "public, immutable";
   }
   ```

2. **AI åˆ†æçµæœå¿«å–**
   - ä½¿ç”¨ Shelve è³‡æ–™åº«å„²å­˜åˆ†æçµæœ
   - ç›¸åŒå½±ç‰‡é¿å…é‡è¤‡åˆ†æ

### è³‡æºé™åˆ¶

1. **è¨­å®š Worker æ•¸é‡**
   ```python
   # gunicorn_config.py
   import multiprocessing
   workers = multiprocessing.cpu_count() * 2 + 1
   ```

2. **è¨˜æ†¶é«”ç®¡ç†**
   - å®šæœŸæ¸…ç†æš«å­˜æª”æ¡ˆ
   - é™åˆ¶åŒæ™‚ä¸Šå‚³æ•¸é‡

---

## ğŸ”’ å®‰å…¨æ€§è¨­å®š

### API é‡‘é‘°ä¿è­·

1. **ç’°å¢ƒè®Šæ•¸ç®¡ç†**
   - çµ•ä¸å°‡ API é‡‘é‘°æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–ç§˜å¯†ç®¡ç†æœå‹™

2. **æ¬Šé™æ§åˆ¶**
   ```bash
   # é™åˆ¶ .env æª”æ¡ˆæ¬Šé™
   chmod 600 .env
   ```

### æª”æ¡ˆä¸Šå‚³å®‰å…¨

1. **æª”æ¡ˆé¡å‹é©—è­‰**
   ```python
   # åœ¨ routes.py ä¸­å¯¦æ–½
   def allowed_file(filename):
       return '.' in filename and \
              filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
   ```

2. **æª”æ¡ˆå¤§å°é™åˆ¶**
   - åœ¨ Nginx å±¤ç´šé™åˆ¶
   - åœ¨æ‡‰ç”¨ç¨‹å¼å±¤ç´šé©—è­‰

### HTTPS è¨­å®š

1. **ä½¿ç”¨ Let's Encrypt**
   ```bash
   # å®‰è£ Certbot
   sudo apt install certbot python3-certbot-nginx
   
   # å–å¾—æ†‘è­‰
   sudo certbot --nginx -d your-domain.com
   ```

2. **å¼·åˆ¶ HTTPS**
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       return 301 https://$server_name$request_uri;
   }
   ```

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### æ—¥èªŒç®¡ç†

1. **è¨­å®šæ—¥èªŒè¼ªæ›¿**
   ```bash
   # /etc/logrotate.d/adaptvideo
   /var/log/adaptvideo/*.log {
       daily
       rotate 14
       compress
       delaycompress
       notifempty
       create 0640 www-data www-data
   }
   ```

2. **æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ**
   ```python
   import logging
   
   logging.basicConfig(
       level=logging.INFO,
       format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
       handlers=[
           logging.FileHandler('/var/log/adaptvideo/app.log'),
           logging.StreamHandler()
       ]
   )
   ```

### æ•ˆèƒ½ç›£æ§

1. **ç³»çµ±è³‡æºç›£æ§**
   ```bash
   # ä½¿ç”¨ htop ç›£æ§
   htop
   
   # ä½¿ç”¨ iotop ç›£æ§ç£ç¢Ÿ
   sudo iotop
   ```

2. **æ‡‰ç”¨ç¨‹å¼ç›£æ§**
   - è¨­å®š Prometheus + Grafana
   - ä½¿ç”¨ New Relic æˆ– DataDog

### å®šæœŸç¶­è­·

1. **æ¸…ç†æš«å­˜æª”æ¡ˆ**
   ```bash
   # å»ºç«‹æ¸…ç†è…³æœ¬
   #!/bin/bash
   find /opt/adaptvideo/uploads -mtime +7 -delete
   find /opt/adaptvideo/outputs -mtime +30 -delete
   ```

2. **è³‡æ–™åº«ç¶­è­·**
   ```python
   # å®šæœŸå£“ç¸® Shelve è³‡æ–™åº«
   import shelve
   
   def compact_database():
       with shelve.open('video_data.db') as db:
           # ç§»é™¤éæœŸè³‡æ–™
           for key in list(db.keys()):
               if is_expired(db[key]):
                   del db[key]
   ```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### æœå‹™ç„¡æ³•å•Ÿå‹•
1. æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«ä½”ç”¨ï¼š
   ```bash
   sudo lsof -i :5001
   ```

2. æª¢æŸ¥æ—¥èªŒï¼š
   ```bash
   journalctl -u adaptvideo -f
   ```

#### AI åˆ†æå¤±æ•—
1. é©—è­‰ API é‡‘é‘°ï¼š
   ```bash
   echo $OPENAI_API_KEY
   ```

2. æª¢æŸ¥ç¶²è·¯é€£ç·šï¼š
   ```bash
   curl https://api.openai.com/v1/models
   ```

#### å½±ç‰‡è½‰æ›éŒ¯èª¤
1. æª¢æŸ¥ FFmpegï¼š
   ```bash
   ffmpeg -version
   ```

2. æª¢æŸ¥ç£ç¢Ÿç©ºé–“ï¼š
   ```bash
   df -h
   ```

### æ•ˆèƒ½å•é¡Œ

1. **CPU ä½¿ç”¨ç‡éé«˜**
   - æ¸›å°‘ Worker æ•¸é‡
   - é™åˆ¶åŒæ™‚è™•ç†æ•¸

2. **è¨˜æ†¶é«”ä¸è¶³**
   - å¢åŠ äº¤æ›ç©ºé–“
   - å„ªåŒ–å½±ç‰‡è¼‰å…¥æ–¹å¼

### ç·Šæ€¥ä¿®å¾©

1. **å¿«é€Ÿé‡å•Ÿ**
   ```bash
   sudo systemctl restart adaptvideo
   ```

2. **æ¸…ç†æ‰€æœ‰æš«å­˜**
   ```bash
   rm -rf uploads/* outputs/*
   sudo systemctl restart adaptvideo
   ```

---

## ğŸ“ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰
- [ ] ç³»çµ±éœ€æ±‚ç¬¦åˆ
- [ ] Python ç‰ˆæœ¬æ­£ç¢º
- [ ] FFmpeg å·²å®‰è£
- [ ] API é‡‘é‘°å·²è¨­å®š
- [ ] é˜²ç«ç‰†è¦å‰‡å·²é…ç½®

### éƒ¨ç½²ä¸­
- [ ] è™›æ“¬ç’°å¢ƒå·²å»ºç«‹
- [ ] ä¾è³´å¥—ä»¶å·²å®‰è£
- [ ] ç›®éŒ„æ¬Šé™æ­£ç¢º
- [ ] æœå‹™æ­£å¸¸å•Ÿå‹•
- [ ] ç¶²é å¯æ­£å¸¸è¨ªå•

### éƒ¨ç½²å¾Œ
- [ ] ä¸Šå‚³åŠŸèƒ½æ¸¬è©¦
- [ ] AI åˆ†ææ¸¬è©¦
- [ ] å½±ç‰‡è½‰æ›æ¸¬è©¦
- [ ] ä¸‹è¼‰åŠŸèƒ½æ¸¬è©¦
- [ ] ç›£æ§ç³»çµ±é‹ä½œ
- [ ] å‚™ä»½æ©Ÿåˆ¶è¨­å®š

---

*æœ¬æŒ‡å—æœ€å¾Œæ›´æ–°æ–¼ï¼š2025å¹´6æœˆ23æ—¥*