# AdaptVideo AI - 智慧影片轉換工具使用指南

## 📋 目錄

1.  [系統需求](#-系統需求)
2.  [安裝與啟動](#-安裝與啟動)
3.  [介面導覽](#-介面導覽)
4.  [核心工作流程 (全新)](#-核心工作流程-全新)
5.  [詳細功能說明](#-詳細功能說明)
6.  [故障排除](#-故障排除)
7.  [技術支援](#-技術支援)

---

## 🖥️ 系統需求

### 最低系統需求
- **作業系統**: Windows 10/11, macOS 10.15+, 或主流 Linux 發行版
- **Python**: 3.8 或更高版本
- **記憶體**: 8GB RAM
- **磁碟空間**: 至少 2GB 可用空間
- **API 金鑰**: 需要一個有效的 `OPENAI_API_KEY` 並將其設定在 `.env` 檔案中
- **網路**: 首次執行及 AI 分析時需要網路連線

### 推薦系統配置
- **處理器**: Intel i5 / AMD Ryzen 5 或更高等級
- **記憶體**: 16GB RAM 或更多
- **顯示卡**: 建議使用 NVIDIA GPU 以加速影片處理
- **儲存空間**: 建議使用 SSD 固態硬碟以提升檔案讀寫速度

---

## 🚀 安裝與啟動

### 首次安裝
1.  **設定 API 金鑰**:
    - 將 ` .env.example` 檔案複製並改名為 `.env`。
    - 在 `.env` 檔案中填入您的 `OPENAI_API_KEY`。
2.  **執行安裝腳本**:
    - **Windows**: 雙擊 `start_windows.bat`。
    - **macOS/Linux**: 在終端機中執行 `./start_unix.sh`。
    此腳本會自動建立虛擬環境、安裝所有必要的 Python 套件。

### 日常啟動
- 安裝完成後，再次執行對應的啟動腳本 (`start_windows.bat` 或 `start_unix.sh`) 即可啟動服務。

### 啟動成功確認
當您在終端機看到類似以下訊息，表示服務已成功啟動：
```
✅ MoviePy 已載入，支援完整影片轉換功能
✅ OpenAI 用戶端已成功初始化。
✅ OpenCV 人臉偵測模型已載入
🚀 使用 Flask 開發伺服器啟動 (除錯模式)
 * Running on http://127.0.0.1:5001
```
此時，請在瀏覽器中開啟 `http://127.0.0.1:5001` 來使用本應用程式。

**注意**: 預設連接埠已從 5000 更改為 5001，以避免與其他服務衝突。

---

## 🧭 介面導覽

### 主要介面元素

應用程式採用現代化的側邊欄設計，主要包含：

1. **側邊導航欄**:
   - **影片轉換**: 主要功能頁面
   - **歷史紀錄**: 查看所有處理過的影片
   - **使用說明**: 內建操作指南

2. **影片來源選擇**:
   - **上傳新影片**: 支援拖放或點擊選擇，最大 500MB
   - **從歷史選擇**: 快速選擇之前上傳過的影片
   - **影片資訊卡**: 顯示檔名、解析度、時長、格式等詳細資訊

3. **轉換模式選擇**:
   - **智慧轉換** (推薦): AI 分析並提供智慧裁切建議
   - **手動轉換**: 傳統中心裁切模式
   - 兩種模式可隨時切換

4. **AI 分析結果** (智慧模式專屬):
   - **識別主體列表**: 顯示所有偵測到的重要元素
   - **主體選擇器**: 支援多選，可選擇要保護的對象
   - **自訂需求**: 可輸入特定要求讓 AI 參考

5. **轉換結果區域**:
   - **多影格預覽**: 轉換前即時預覽效果
   - **並排比較**: 原始與轉換後影片對照
   - **智慧分析報告**: 顯示裁切覆蓋率和偏移量

---

## 💡 核心工作流程 (全新)

這是一個典型的使用流程，充分利用了 AdaptVideo 的智慧功能，整個過程都在「智慧轉換」分頁中完成。

### 步驟 1: 上傳影片並等待 AI 分析
- 點擊上傳區或將影片檔案拖曳至此。
- 系統會自動上傳並進行 AI 分析，您可以在下方看到進度條。
- 分析完成後，**原始影片預覽**下方會出現「✅ 分析完成」的提示。

### 步驟 2: 進入智慧轉換流程
分析完成後，介面會自動展示 AI 推薦的三步驟流程：

#### **第 1 步：選擇保護對象**
- **功能**: 告訴 AI 在轉換過程中，哪些物體是您最關心的
- **操作**:
    - 系統會以卡片形式列出所有識別到的主要物體
    - **支援多選**: 您可以勾選一個或多個物體
    - **智慧中心點**: 當您選擇多個物體時，AI 會根據重要性和信心度自動計算加權中心點
    - **主體縮圖**: 每個識別到的主體都會顯示對應的縮圖預覽
- **提示**: 
    - 物體卡片顯示重要性（🔥高、⭐中、💡低）和信心度百分比
    - 選擇多個主體時，系統會智慧平衡所有選中對象的位置

#### **第 2 步：自訂需求與 AI 建議**
- **自訂需求功能** (全新):
    - 在 AI 分析前，可先輸入您的特定需求
    - 支援自然語言描述，例如：
      - 「重點保留人物臉部」
      - 「適合戶外廣告使用」
      - 「確保品牌標誌清晰可見」
      - 「強調產品特寫」
    - AI 會根據您的需求調整分析重點和建議

- **AI 專業建議**:
    - **對話記憶**: AI 會記住之前的分析內容，可進行多輪對話優化
    - **智慧推薦**: 優先推薦無需裁切的模板（相同比例）
    - **次要建議**: 提供需要智慧裁切的備選方案
    - **Markdown 格式**: 結構化呈現分析結果

#### **第 3 步：預覽與轉換**
- **多影格預覽**:
    - 點擊「預覽」查看 5 個關鍵時間點的裁切效果
    - **裁切警告**: 紅框表示有主體被裁切，綠框表示安全
    - **覆蓋率分析**: 顯示每個主體的保留百分比
    - **中心偏移**: 顯示智慧裁切的調整量

- **開始轉換**:
    - 確認預覽效果後點擊「開始轉換」
    - 轉換過程會顯示進度條
    - 支援批次轉換多個尺寸

### 步驟 3: 查看並下載最終結果
- 轉換完成後，頁面會自動滾動到下方的「轉換結果」區域。
- **並排比較**: 您可以在此同時播放原始影片和轉換後的影片，進行最直觀的效果對比。影片的顯示尺寸經過最佳化，方便比較。
- **下載**: 點擊「📥 下載影片」按鈕即可儲存轉換好的檔案。

---

## 🎯 詳細功能說明

### 智慧轉換功能詳解

#### AI 分析技術
- **多模態視覺模型**: 使用 OpenAI GPT-4 Vision API 分析影片內容
- **智慧取樣**: 自動從影片中擷取 5 個代表性畫面進行分析
- **專業角色設定**: AI 以「數位戶外看板內容分析師」角度提供建議
- **主體識別**: 自動偵測人物、產品、文字、標誌等行銷元素

#### 多主體智慧裁切
- **加權中心計算**: 根據重要性和信心度計算最佳裁切中心
- **邊界保護**: 自動調整避免裁切超出影片範圍
- **多選支援**: 可同時選擇多個主體進行保護
- **即時預覽**: 選擇主體後立即看到裁切效果

#### 自訂需求整合
- **自然語言理解**: 支援中文自然語言描述需求
- **情境感知**: AI 會根據您的行業和用途調整建議
- **迭代優化**: 可多次調整需求直到滿意

### 手動轉換模式

適合不需要 AI 分析的簡單轉換需求：

1. **選擇目標尺寸**: 從預設模板中選擇或自訂尺寸
2. **裁切模式**:
   - **中心裁切**: 保持畫面中心不變
   - **人臉追蹤**: 自動偵測並追蹤人臉（使用 OpenCV）
3. **即時預覽**: 調整參數後即時查看效果
4. **快速轉換**: 無需等待 AI 分析，直接轉換

### 轉換結果與比較

#### 視覺化比較工具
- **並排對比**: 原始與轉換影片同步播放
- **智慧縮放**: 自動調整顯示比例便於比較
- **詳細資訊**: 顯示解析度、比例、檔案大小等
- **比例分析圖**: 視覺化呈現尺寸變化

#### 處理歷程
- **轉換紀錄**: 保存所有轉換版本
- **參數記錄**: 可查看每次轉換使用的設定
- **批次下載**: 支援一次下載多個版本

### 進階功能

#### 歷史紀錄管理
- **影片庫**: 所有上傳過的影片都會保存
- **快速重用**: 可從歷史選擇影片避免重複上傳
- **分析快取**: AI 分析結果會保存，重複使用更快速

#### 批次處理
- **多尺寸轉換**: 一次選擇多個目標尺寸
- **佇列管理**: 自動排程處理多個任務
- **進度追蹤**: 即時顯示每個任務狀態

#### 邊界保護技術
- **智慧邊界檢測**: 自動確保裁切範圍不超出影片
- **無黑邊保證**: 所有輸出影片都不會有黑邊
- **安全區域提示**: 預覽時顯示安全裁切區域

---

## 🔧 故障排除

### 常見問題及解決方案

**問題 1: 服務無法啟動**
- **檢查 `.env`**: 確認 `.env` 檔案存在且 `OPENAI_API_KEY` 已正確填寫。
- **查看日誌**: 檢查終端機的錯誤訊息，可能是網路問題或套件安裝失敗。
- **手動安裝**: 嘗試在終端機手動執行 `pip install -r requirements.txt`。

**問題 2: AI 分析失敗**
- **檢查 API 金鑰**: 確保您的 OpenAI API 金鑰有效且額度充足
- **檢查網路**: AI 分析需要連接到 OpenAI 伺服器
- **影片內容**: 過於模糊或無明確主體的影片可能導致分析困難
- **檔案大小**: 確保影片檔案不超過 500MB 限制

**問題 3: 轉換速度緩慢**
- **影片大小**: 4K 影片轉換需要較長時間
- **系統資源**: 關閉其他應用程式釋放記憶體
- **硬碟空間**: 確保有足夠空間存放轉換後檔案

**問題 4: 預覽功能異常**
- **瀏覽器相容性**: 建議使用 Chrome、Firefox 或 Edge
- **快取問題**: 嘗試清除瀏覽器快取
- **重新整理**: 按 F5 重新載入頁面

---

## 💡 使用技巧

### 最佳實踐
1. **影片準備**:
   - 使用高品質原始素材以獲得最佳效果
   - 避免過度壓縮的影片檔案
   - 確保重要內容不要太靠近邊緣

2. **AI 分析優化**:
   - 提供明確的自訂需求可獲得更精準建議
   - 選擇多個相關主體可改善裁切效果
   - 利用對話記憶功能逐步優化結果

3. **效能提升**:
   - 使用歷史紀錄避免重複上傳
   - 批次處理多個尺寸可節省時間
   - 定期清理不需要的轉換檔案

## 📞 技術支援

### 問題回報
遇到問題時，請提供：
1. 作業系統版本
2. Python 版本（執行 `python --version`）
3. 錯誤訊息截圖或文字
4. 問題發生的操作步驟
5. 使用的影片格式和大小

### 聯絡方式
- GitHub Issues: [專案頁面](https://github.com/anthropics/claude-code/issues)
- 技術文件: 參考 CLAUDE.md 檔案

---

*本指南最後更新於: 2025年6月23日*

---

## 📚 附錄：支援格式與限制

### 支援的影片格式
- MP4 (H.264/H.265)
- MOV (QuickTime)
- AVI
- MKV
- WebM

### 預設 DOOH 模板
1. **高雄版位**: 3840×1526 - 高雄 LED 看板專用
2. **忠孝商圈**: 1440×960 - 忠孝商圈數位看板
3. **標準 16:9**: 1920×1080 - Full HD 標準尺寸
4. **4K 橫屏**: 3840×2160 - 4K Ultra HD
5. **豎屏 9:16**: 1080×1920 - 手機直向顯示
6. **方形 1:1**: 1080×1080 - 社群媒體用
7. **超寬屏**: 2560×1080 - 21:9 超寬比例

### 系統限制
- 單檔上限: 500MB
- AI 分析: 最多擷取 90 個影格
- 預覽品質: JPEG 75% 壓縮
- 最大寬度: 依原始影片解析度

