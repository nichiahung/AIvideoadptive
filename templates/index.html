<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdaptVideo - 影片尺寸轉換工具</title>
    
    <!-- 外部依賴 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- 樣式表 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- 側邊欄導航 -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>AdaptVideo</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="converter">
                    <a href="#"><span class="icon">🔧</span>影片轉換</a>
                </li>
                <li class="nav-item" data-page="history">
                    <a href="#"><span class="icon">📁</span>歷史紀錄</a>
                </li>
                <li class="nav-item" data-page="guide">
                    <a href="#"><span class="icon">❓</span>使用說明</a>
                </li>
            </ul>
        </nav>

        <!-- 主要內容區域 -->
        <main class="main-content">
            <!-- 影片轉換頁面 -->
            <div id="page-converter" class="page active">
                <div class="container">
                    <!-- 影片來源選擇 -->
                    <div class="content-section">
                        <div class="section-title">
                            <span class="icon">📂</span>影片來源
                        </div>
                        
                        <div class="video-source-selection">
                            <div class="source-option" id="uploadOption">
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-icon">📤</div>
                                    <div class="upload-text">點擊選擇影片檔案或拖拽到此處</div>
                                    <div class="upload-hint">支援 MP4, MOV 格式，檔案大小限制 500MB</div>
                                </div>
                                <input type="file" id="fileInput" class="file-input" accept="video/*">
                            </div>
                            
                            <div class="upload-divider"><span>或</span></div>
                            
                            <div class="source-option" id="historyOption">
                                <button id="showHistoryBtn" class="btn btn-secondary" style="width: 100%; padding: 16px; font-size: 14px;">
                                    📁 從歷史紀錄選擇影片
                                </button>
                            </div>
                        </div>
                        
                        <!-- 影片預覽區域 -->
                        <div id="videoPreview" style="display: none;">
                            <div class="video-preview">
                                <div style="position: relative; display: inline-block;">
                                    <img id="videoThumbnail" class="video-thumbnail" src="" alt="影片縮圖"/>
                                    <button id="originalPreviewBtn" class="btn btn-secondary" style="position: absolute; top: 8px; right: 8px; font-size: 11px; padding: 4px 8px;">
                                        🎬 動態預覽
                                    </button>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <!-- AI 識別的主體選擇 -->
                                    <div id="subjectChoices" class="subject-choices"></div>
                                    
                                    <!-- 影片資訊 -->
                                    <div id="videoInfo"></div>
                                </div>
                            </div>
                            
                            <!-- AI 分析結果 -->
                            <div id="aiAnalysisContent"></div>
                        </div>
                    </div>

                    <!-- 推薦模板區域 -->
                    <div id="templatesSection" style="display: none;">
                        <div class="content-section">
                            <div id="recommendedTemplates"></div>
                            <div id="templatePreview"></div>
                        </div>
                    </div>

                    <!-- 轉換設定 -->
                    <div id="conversionSection" style="display: none;">
                        <div class="content-section">
                            <nav class="tab-navigation">
                                <div class="tab-nav-item active" data-tab="smart">智慧轉換</div>
                                <div class="tab-nav-item" data-tab="manual">手動轉換</div>
                            </nav>
                            
                            <!-- 智慧轉換標籤 -->
                            <div id="tab-smart" class="tab-content active">
                                <div class="section-title"><span class="icon">🤖</span>AI 推薦結果</div>
                                <div id="smartConversionContent">
                                    <div class="spinner"></div>
                                    <p style="text-align: center; color: var(--gray-500); margin-top: 12px;">正在分析影片內容...</p>
                                </div>
                            </div>

                            <!-- 手動轉換標籤 -->
                            <div id="tab-manual" class="tab-content">
                                <div class="section-title"><span class="icon">⚙️</span>選擇輸出尺寸</div>
                                <div id="templatesGridManual" class="templates-grid"></div>
                                
                                <div class="section-title" style="margin-top: 24px;"><span class="icon">✂️</span>裁切模式</div>
                                <div class="crop-options">
                                    <label class="crop-option">
                                        <input type="radio" name="cropModeManual" value="center" checked>
                                        <div class="option-content">
                                            <strong>置中裁切</strong>
                                            <p>從影片中心進行裁切</p>
                                        </div>
                                    </label>
                                    <label class="crop-option" id="llmCropOption" style="display: none;">
                                        <input type="radio" name="cropModeManual" value="llm">
                                        <div class="option-content">
                                            <strong>智慧裁切</strong>
                                            <p>根據 AI 識別的主要對象進行裁切</p>
                                        </div>
                                    </label>
                                </div>

                                <div id="manualSubjectChoices" class="subject-choices" style="margin-top: 16px;"></div>

                                <div style="margin-top: 20px;">
                                    <button class="btn btn-primary" id="convertBtnManual" disabled>
                                        開始轉換
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 下載區域 -->
                    <div style="margin-top: 20px; text-align: center;">
                        <div id="downloadSection" style="display: none;">
                            <a id="downloadBtn" class="btn btn-primary" download>
                                📥 下載轉換後的影片
                            </a>
                            <button id="compareBtn" class="btn btn-secondary" style="margin-left: 12px;">
                                🔄 原始vs轉換對比
                            </button>
                        </div>
                    </div>

                    <!-- 比較區域 -->
                    <div id="comparisonSection" style="display: none;">
                        <div class="content-section">
                            <div class="section-title">
                                <span class="icon">🔄</span>原始影片 vs 轉換後影片
                                <button id="closeCompareBtn" class="btn btn-secondary" style="float: right; font-size: 12px; padding: 4px 8px;">
                                    關閉比較
                                </button>
                            </div>
                            <div id="comparisonContent"></div>
                        </div>
                    </div>

                    <!-- 狀態訊息 -->
                    <div class="status-message" id="statusMessage" style="display: none;"></div>
                </div>
            </div>

            <!-- 歷史紀錄頁面 -->
            <div id="page-history" class="page">
                <div class="container">
                    <div class="content-section">
                        <div class="section-title"><span class="icon">📁</span>歷史紀錄</div>
                        <div id="history-content">
                            <p>請使用「從歷史紀錄選擇影片」按鈕來查看已上傳的影片。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 使用說明頁面 -->
            <div id="page-guide" class="page">
                <div class="container">
                    <div class="content-section">
                        <div class="section-title"><span class="icon">❓</span>使用說明</div>
                        <div style="line-height: 1.6;">
                            <h3 style="color: var(--gray-800); margin: 16px 0 8px;">基本操作</h3>
                            <ol style="margin-left: 20px; color: var(--gray-600);">
                                <li>選擇影片檔案或從歷史紀錄中選擇</li>
                                <li>等待 AI 自動分析影片內容</li>
                                <li>查看 AI 推薦的 DOOH 模板</li>
                                <li>選擇想要的主體並點擊模板進行轉換</li>
                                <li>下載轉換完成的影片</li>
                            </ol>
                            
                            <h3 style="color: var(--gray-800); margin: 20px 0 8px;">支援格式</h3>
                            <p style="color: var(--gray-600);">MP4, MOV, AVI, MKV 等常見影片格式，檔案大小限制 500MB</p>
                            
                            <h3 style="color: var(--gray-800); margin: 20px 0 8px;">裁切模式</h3>
                            <ul style="margin-left: 20px; color: var(--gray-600);">
                                <li><strong>置中裁切：</strong>從影片中心位置進行裁切</li>
                                <li><strong>智慧裁切：</strong>AI 自動識別主要對象並以其為中心裁切</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 歷史紀錄 Modal -->
    <div id="videoHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>選擇影片</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="videoHistoryGrid"></div>
        </div>
    </div>

    <!-- JavaScript 模組 -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
</body>
</html>